<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Study Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family: Arial; background: linear-gradient(to bottom right,#dbeafe,#eef2ff); padding:10px;}
h2{text-align:center;}
.container{background:white; padding:10px; border-radius:12px; box-shadow:0 0 10px #999; margin-top:10px;}
table{width:100%; border-collapse:collapse;}
th,td{border:1px solid #ccc; text-align:center; padding:5px;}
button{width:100%; padding:6px; border:none; border-radius:6px; background:#e0e7ff; transition:0.3s;}
button:hover{background:#a5b4fc; cursor:pointer;}
button.pressed{background:#818cf8; color:white;}
.reset{margin-top:10px; background:#f87171; color:white; width:100%; padding:10px; border:none; border-radius:6px;}
canvas{margin-top:10px;}
</style>
</head>

<body>

<h2 id="month"></h2>

<div class="container">
<table>
<tr>
<th>Science</th>
<th colspan="4">Week 1</th>
<th colspan="4">Week 2</th>
<th colspan="4">Week 3</th>
<th colspan="4">Week 4</th>
</tr>
<tbody id="table"></tbody>
</table>

<button class="reset" onclick="resetAll()">Reset Month</button>
</div>

<div class="container">
<canvas id="mathDonut"></canvas>
<canvas id="pcDonut"></canvas>
<canvas id="svtDonut"></canvas>
<canvas id="lineChart"></canvas>
</div>

<script>

let now = new Date();
document.getElementById("month").innerText =
"Progress - " + now.toLocaleString("default",{month:"long"});

let daysInMonth =
new Date(now.getFullYear(), now.getMonth()+1,0).getDate();

const mathPoints = [20,20,20,40];
const pcPoints   = [25,20,35,20];
const svtPoints  = [20,20,45,15];

function load(){
let s = localStorage.getItem("studyData");
if(s) return JSON.parse(s);
return {math:Array(16).fill(0), pc:Array(16).fill(0), svt:Array(16).fill(0)};
}

let progress = load();

function save(){
localStorage.setItem("studyData",JSON.stringify(progress));
}

function makeRow(science, points){
let html = `<tr><td><b>${science}</b></td>`;
for(let i=0;i<16;i++){
let p = points[i%4];
let pressed = progress[science.toLowerCase()][i] > 0 ? "pressed" : "";
html += `<td><button class="${pressed}"
onclick="add('${science.toLowerCase()}',${i},${p},this)">${p}</button></td>`;
}
html += "</tr>";
return html;
}

document.getElementById("table").innerHTML =
makeRow("Math", mathPoints) +
makeRow("PC", pcPoints) +
makeRow("SVT", svtPoints);

function add(science,index,points,btn){
progress[science][index] = points;
btn.classList.add("pressed");
save();
updateCharts();
}

function resetAll(){
if(confirm("Reset everything?")){
progress = {math:Array(16).fill(0), pc:Array(16).fill(0), svt:Array(16).fill(0)};
save();
document.querySelectorAll("button").forEach(b=>b.classList.remove("pressed"));
updateCharts();
}
}

function donutPercent(science){
return progress[science].reduce((a,b)=>a+b*0.25,0);
}

let mathDonut = new Chart(document.getElementById("mathDonut"),{
type:"doughnut",
data:{labels:["Math","Remaining"],datasets:[{data:[0,100],backgroundColor:["red","#ddd"]}]}
});

let pcDonut = new Chart(document.getElementById("pcDonut"),{
type:"doughnut",
data:{labels:["PC","Remaining"],datasets:[{data:[0,100],backgroundColor:["green","#ddd"]}]}
});

let svtDonut = new Chart(document.getElementById("svtDonut"),{
type:"doughnut",
data:{labels:["SVT","Remaining"],datasets:[{data:[0,100],backgroundColor:["blue","#ddd"]}]}
});


// ===== LINE CHART WITH TRUE ZERO ORIGIN =====

let labels = [0];
for(let i=1;i<=daysInMonth;i++) labels.push(i);

let lineChart = new Chart(document.getElementById("lineChart"),{
type:"line",
data:{
labels: labels,
datasets:[
{label:"Math",data:Array(daysInMonth+1).fill(0),borderColor:"red",fill:false},
{label:"PC",data:Array(daysInMonth+1).fill(0),borderColor:"green",fill:false},
{label:"SVT",data:Array(daysInMonth+1).fill(0),borderColor:"blue",fill:false}
]
},
options:{
scales:{
y:{min:0,max:100,ticks:{stepSize:5}},
x:{title:{display:true,text:"Days of Month"}}
}
}
});

function calculateLine(){

let math = Array(daysInMonth+1).fill(null);
let pc   = Array(daysInMonth+1).fill(null);
let svt  = Array(daysInMonth+1).fill(null);

math[0] = 0;
pc[0] = 0;
svt[0] = 0;

let weekSize = Math.floor(daysInMonth/4);

for(let w=0;w<4;w++){

let i = w*4;

let m = (progress.math[i]||0)+(progress.math[i+1]||0)+
(progress.math[i+2]||0)+(progress.math[i+3]||0);

let p = (progress.pc[i]||0)+(progress.pc[i+1]||0)+
(progress.pc[i+2]||0)+(progress.pc[i+3]||0);

let s = (progress.svt[i]||0)+(progress.svt[i+1]||0)+
(progress.svt[i+2]||0)+(progress.svt[i+3]||0);

let day = Math.min((w+1)*weekSize, daysInMonth);

math[day] = m;
pc[day] = p;
svt[day] = s;
}

function connect(arr){
let last = 0;
for(let i=0;i<arr.length;i++){
if(arr[i]==null) arr[i] = last;
else last = arr[i];
}
return arr;
}

return [connect(math),connect(pc),connect(svt)];
}

function updateCharts(){

mathDonut.data.datasets[0].data = [donutPercent("math"),100-donutPercent("math")];
pcDonut.data.datasets[0].data   = [donutPercent("pc"),100-donutPercent("pc")];
svtDonut.data.datasets[0].data  = [donutPercent("svt"),100-donutPercent("svt")];

mathDonut.update();
pcDonut.update();
svtDonut.update();

let lines = calculateLine();

lineChart.data.datasets[0].data = lines[0];
lineChart.data.datasets[1].data = lines[1];
lineChart.data.datasets[2].data = lines[2];

lineChart.update();
}

updateCharts();

</script>
</body>
</html>
