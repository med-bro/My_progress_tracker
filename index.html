<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Science Progress Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 10px; padding: 0; background: #f0f0f0; }
  h1 { text-align: center; margin-bottom: 10px; }
  .month { text-align: center; margin-bottom: 20px; font-size: 1.2em; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  input { width: 50px; text-align: center; }
  .charts { display: flex; flex-direction: column; gap: 20px; }
  canvas { background: white; border-radius: 10px; padding: 10px; }
</style>
</head>
<body>

<h1>Science Progress Tracker</h1>
<div class="month" id="monthName"></div>

<table id="pointsTable">
  <thead>
    <tr>
      <th>Day</th>
      <th>Math</th>
      <th>SVT</th>
      <th>PC</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <!-- Rows will be generated by JS -->
  </tbody>
</table>

<div class="charts">
  <canvas id="donutChart" height="200"></canvas>
  <canvas id="lineChart" height="200"></canvas>
</div>

<script>
const sciences = {
  Math: [2,2,2,40],
  SVT: [20,20,45,15],
  PC: [25,20,35,20]
};

const maxPoints = { Math:100, SVT:100, PC:100 };
let pointsEntered = {}; // store points by day

// Get current month name
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const currentMonth = new Date().getMonth();
document.getElementById("monthName").innerText = monthNames[currentMonth];

// Generate table rows for each day of month
const daysInMonth = new Date(new Date().getFullYear(), currentMonth+1, 0).getDate();
const tableBody = document.getElementById("tableBody");

for(let day=1; day<=daysInMonth; day++){
  const row = document.createElement("tr");
  row.innerHTML = `<td>${day}</td>
  <td><input type="number" min="0" max="40" data-science="Math" data-day="${day}"></td>
  <td><input type="number" min="0" max="45" data-science="SVT" data-day="${day}"></td>
  <td><input type="number" min="0" max="35" data-science="PC" data-day="${day}"></td>`;
  tableBody.appendChild(row);
}

// Initialize Chart.js charts
const donutCtx = document.getElementById('donutChart').getContext('2d');
const lineCtx = document.getElementById('lineChart').getContext('2d');

let donutChart = new Chart(donutCtx, {
  type: 'doughnut',
  data: {
    labels: ["Math","SVT","PC"],
    datasets: [{
      data: [0,0,0],
      backgroundColor: ['#FF6384','#36A2EB','#FFCE56']
    }]
  },
  options: {
    responsive:true,
    plugins:{ legend:{ position:'top' }, title:{ display:true, text:'Donut Chart Progress (%)' } }
  }
});

let lineChart = new Chart(lineCtx, {
  type: 'line',
  data: {
    labels: Array.from({length:daysInMonth},(_,i)=>i+1),
    datasets: [
      {label:'Math', data: Array(daysInMonth).fill(0), borderColor:'#FF6384', fill:false},
      {label:'SVT', data: Array(daysInMonth).fill(0), borderColor:'#36A2EB', fill:false},
      {label:'PC', data: Array(daysInMonth).fill(0), borderColor:'#FFCE56', fill:false}
    ]
  },
  options: {
    responsive:true,
    plugins:{ legend:{ position:'top' }, title:{ display:true, text:'Line Chart Progress (%)' } },
    scales:{ y:{ min:0, max:100 } }
  }
});

// Update charts when input changes
document.querySelectorAll('input').forEach(input=>{
  input.addEventListener('input', e=>{
    const day = e.target.dataset.day;
    const science = e.target.dataset.science;
    const value = parseFloat(e.target.value)||0;
    if(!pointsEntered[day]) pointsEntered[day] = {};
    pointsEntered[day][science] = value;
    updateCharts();
  });
});

function updateCharts(){
  const totals = { Math:0, SVT:0, PC:0 };
  for(let day in pointsEntered){
    for(let s in sciences){
      totals[s] += pointsEntered[day][s] || 0;
    }
  }
  // Update donut chart (as % of max 100 per science)
  donutChart.data.datasets[0].data = ['Math','SVT','PC'].map(s=>Math.min((totals[s]/maxPoints[s])*100,100));
  donutChart.update();

  // Update line chart day by day
  lineChart.data.datasets.forEach(ds=>{
    const s = ds.label;
    ds.data = Array.from({length:daysInMonth},(_,i)=>{
      const day = i+1;
      return pointsEntered[day]?.[s] ? Math.min((pointsEntered[day][s]/maxPoints[s])*100,100) : 0;
    });
  });
  lineChart.update();
}

// Daily notification at 11:00 Morocco time
function scheduleNotification(){
  if (!("Notification" in window)) return;
  Notification.requestPermission().then(permission=>{
    if(permission==="granted"){
      const now = new Date();
      const target = new Date();
      target.setHours(11,0,0,0);
      if(now>target) target.setDate(target.getDate()+1);
      const timeout = target - now;
      setTimeout(()=>{
        new Notification("Time to enter your science points!");
        // reschedule for next day
        scheduleNotification();
      }, timeout);
    }
  });
}
scheduleNotification();

</script>
</body>
</html>